\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{chapter-format-leftrule}[2014/10/23 Title chapter package]


\RequirePackage{xcolor}
\RequirePackage{kvoptions} % Carga la biblioteca kvoptions
\RequirePackage[explicit]{titlesec} % necesario para titleformat. [explicit] habilita usar #1
\RequirePackage{lmodern}  % The lmodern package was used just to have access to a 80pt font size.
\RequirePackage{tabularx} 

\makeatletter


% Define las opciones de paquete Width y TextColor
\SetupKeyvalOptions{
  family=ChapterFormatLeftRule,
  prefix=ChapterFormatLeftRule@
}

\DeclareStringOption[1.5pt]{RuleTickness}
\DeclareStringOption[black]{TitleColor}
\DeclareStringOption[-2.5ex]{TitleAfterSkip}
\DeclareStringOption[25]{TitleFontSize}
\DeclareStringOption[black]{PreTitleColor}
\DeclareStringOption[30]{PreTitleFontSize}
\DeclareStringOption[70]{PreTitleNumberFontSize}
\DeclareStringOption[black]{RuleColor}

% Procesa las opciones del paquete
\ProcessKeyvalOptions*


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title with number
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titleformat{\chapter}[display]
{\bfseries\Huge} %format
{%%label
\begin{tabularx}{\textwidth}{@{}Xl@{}}
\raisebox{3ex}{\color{\ChapterFormatLeftRule@RuleColor}\rule[-1.8ex]{\linewidth}{\ChapterFormatLeftRule@RuleTickness}}%\vspace{1.5ex}%
& 
\textsuperscript{\fontsize{\ChapterFormatLeftRule@PreTitleFontSize}{0}\color{\ChapterFormatLeftRule@PreTitleColor}\selectfont{\chaptername}~}%
{\fontsize{\ChapterFormatLeftRule@PreTitleNumberFontSize}{0}\color{\ChapterFormatLeftRule@PreTitleColor}\selectfont\thechapter}
\end{tabularx}
\begin{tabular}{p{\textwidth}} 
\textcolor{\ChapterFormatLeftRule@TitleColor}{#1}
\end{tabular}
} %
{0ex}%sep
{\bfseries\fontsize{\ChapterFormatLeftRule@TitleFontSize}{0}\selectfont}%before code
[\vspace{\ChapterFormatLeftRule@TitleAfterSkip}]%%aftercode


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title without number
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titleformat{name=\chapter,numberless}[display]
{\bfseries\Huge} %format
{%%label
\begin{tabularx}{\textwidth}{@{}Xl@{}}
\raisebox{3ex}{\color{\ChapterFormatLeftRule@RuleColor}\rule[-1.8ex]{\linewidth}{\ChapterFormatLeftRule@RuleTickness}}%\vspace{1.5ex}%
& 
\end{tabularx}
\begin{tabular}{p{\textwidth}} 
\textcolor{\ChapterFormatLeftRule@TitleColor}{#1}
\end{tabular}
} %
{0pt}%sep
{\bfseries\fontsize{\ChapterFormatLeftRule@TitleFontSize}{0}\selectfont}%before code
[\vspace{\ChapterFormatLeftRule@TitleAfterSkip}]%%afercode

\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% spacing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titlespacing{\chapter}
{0pt}% left spacing
{0pt}% before spacing
{0pt}% after spacing
%[right]

\titlespacing*{\chapter}
{0pt}% left spacing
{0pt}% before spacing
{0pt}% after spacing
%[right]

