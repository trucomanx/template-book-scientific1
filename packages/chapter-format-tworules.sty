\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{chapter-format-tworules}[2014/10/23 Title chapter package]


\RequirePackage{xcolor}
\RequirePackage{kvoptions} % Carga la biblioteca kvoptions
\RequirePackage[explicit]{titlesec} % necesario para titleformat. [explicit] habilita usar #1

\makeatletter

% Define las opciones de paquete Width y TextColor
\SetupKeyvalOptions{
  family=ChapterFormatTwoRules,
  prefix=ChapterFormatTwoRules@
}

\DeclareStringOption[1.5pt]{RuleTickness}
\DeclareStringOption[black]{TitleColor}
\DeclareStringOption[black]{PreTitleColor}
\DeclareStringOption[black]{RuleColor}
\DeclareStringOption[0ex]{AfterSpace}

% Procesa las opciones del paquete
\ProcessKeyvalOptions*


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title with number
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titleformat{\chapter}% command
[display]%shape
{\bfseries\huge}% format
{%
\Large\filright%
\textcolor{\ChapterFormatTwoRules@PreTitleColor}{\MakeUppercase{\chaptertitlename}} % \chaptertitlename = "Chapter"
\Huge\textcolor{\ChapterFormatTwoRules@PreTitleColor}{\thechapter}\vspace{-1.5ex}%
}% label
{0ex}% sep
{%
\textcolor{\ChapterFormatTwoRules@RuleColor}{\rule{\linewidth}{\ChapterFormatTwoRules@RuleTickness}}\\[0ex]
\filleft\textcolor{\ChapterFormatTwoRules@TitleColor}{#1}\\[-1ex]%\vspace{-1ex}%
\textcolor{\ChapterFormatTwoRules@RuleColor}{\rule{\linewidth}{\ChapterFormatTwoRules@RuleTickness}}
}%before code
[\vspace{\ChapterFormatTwoRules@AfterSpace}]%after code


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title without number
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titleformat{name=\chapter,numberless}% command
[display]%shape
{\bfseries\huge}% format
{}% label
{0ex}% sep
{%
\textcolor{\ChapterFormatTwoRules@RuleColor}{\rule{\linewidth}{\ChapterFormatTwoRules@RuleTickness}}\\[0ex]
\filleft\textcolor{\ChapterFormatTwoRules@TitleColor}{#1}\\[-1ex]%\vspace{-1ex}%
\textcolor{\ChapterFormatTwoRules@RuleColor}{\rule{\linewidth}{\ChapterFormatTwoRules@RuleTickness}}
}%before code
[\vspace{\ChapterFormatTwoRules@AfterSpace}]%after code

\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% spacing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titlespacing{\chapter}
{0pt}% left spacing
{0pt}% before spacing
{0pt}% after spacing
%[right]

\titlespacing*{\chapter}
{0pt}% left spacing
{0pt}% before spacing
{0pt}% after spacing
%[right]

