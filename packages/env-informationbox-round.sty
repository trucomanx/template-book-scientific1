%% source:
%% https://github.com/trucomanx/env-informationbox-round


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{env-informationbox-round}[2022/05/21 Package with macros to the math enviroment]


\RequirePackage[most]{tcolorbox}
\RequirePackage{xcolor}
\RequirePackage[explicit]{titlesec} %% sections
\RequirePackage{titletoc} %% TOC
\RequirePackage{xparse} %%\ExplSyntaxOn
\RequirePackage{calc}%% para restar


% Options
%\DeclareOption{red}{\renewcommand{\wordcolour}{sharelatexcolour}}
\DeclareOption*{\PackageWarning{env-informationbox-round}{The option ‘\CurrentOption’ is current unknown}}
\ProcessOptions\relax


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Macros 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% defining variable
\newlength{\EnvInformationBoxRoundThickness}
\setlength{\EnvInformationBoxRoundThickness}{2pt}%{0.8mm}

%% left rule
\newlength{\EnvInformationBoxRoundLeftRule}
\setlength{\EnvInformationBoxRoundLeftRule}{40pt}%{14mm}


%% Define before space
\newcommand{\EnvInformationBoxRoundBeforeSpace}{0pt}
\newcommand{\SetEnvInformationBoxRoundBeforeSpace}[1]{\renewcommand{\EnvInformationBoxRoundBeforeSpace}{#1}}%

%% Define after space
\newcommand{\EnvInformationBoxRoundAfterSpace}{0pt}
\newcommand{\SetEnvInformationBoxRoundAfterSpace}[1]{\renewcommand{\EnvInformationBoxRoundAfterSpace}{#1}}%

%% Define showed name of enviroment
\newcommand{\EnvInformationBoxRoundPreTitle}{Information}
\newcommand{\SetEnvInformationBoxRoundPreTitle}[1]{\renewcommand{\EnvInformationBoxRoundPreTitle}{#1}}%

%% Define the frame color of enviroment
\newcommand{\EnvInformationBoxRoundFrameColor}{red!50!black}
\newcommand{\SetEnvInformationBoxRoundFrameColor}[1]{\renewcommand{\EnvInformationBoxRoundFrameColor}{#1}}%

%% Define the backaground body text color
\newcommand{\EnvInformationBoxRoundBackColor}{gray!10}
\newcommand{\SetEnvInformationBoxRoundBackColor}[1]{\renewcommand{\EnvInformationBoxRoundBackColor}{#1}}%

%% Define The title body color 
\newcommand{\EnvInformationBoxRoundTitleColor}{blue}
\newcommand{\SetEnvInformationBoxRoundTitleColor}[1]{\renewcommand{\EnvInformationBoxRoundTitleColor}{#1}}%

%% Define the tile font 
\newcommand{\EnvInformationBoxRoundTitleFont}{\bfseries}
\newcommand{\SetEnvInformationBoxRoundTitleFont}[1]{\renewcommand{\EnvInformationBoxRoundTitleFont}{#1}}%

%% Define the image of pretitle
\newcommand{\EnvInformationBoxRoundImage}{\vspace{\EnvInformationBoxRoundThickness}\Huge\itshape\bfseries \textcolor{white}{i}}
\newcommand{\SetEnvInformationBoxRoundImage}[1]{\renewcommand{\EnvInformationBoxRoundImage}{#1}}%

%% Define Left width
\newcommand{\SetEnvInformationBoxRoundLeftRule}[1]%
{
    \setlength{\EnvInformationBoxRoundLeftRule}{#1}
}%

%% Define Left width
\newcommand{\SetEnvInformationBoxRoundThickness}[1]%
{
    \setlength{\EnvInformationBoxRoundThickness}{#1}
}%


%% Warning: These variables dont have \Set... method
\newcommand{\EnvInformationBoxRoundListingExt}{EnvInformationBoxRoundListingExt}
\newcommand{\EnvInformationBoxRoundTocEntryFormat}{}
%
\newcommand{\EnvInformationBoxRoundBoxArc}{2mm}




%% Crea una macro que capitaliza la primera letra
\ExplSyntaxOn
\NewExpandableDocumentCommand \InformationBoxRoundFirstLetterUppercase { O{} m }
  { \text_titlecase:nn {#1} {#2} }
\ExplSyntaxOff

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Create a new counter that will follow tcolorbox's numbering
%% Create a new counter that will follow tcolorbox's numbering
\newcounter{informationboxCounter}[section]
\renewcommand*{\theinformationboxCounter}{\noexpand\thesection.\noexpand\arabic{informationboxCounter}}

\newtcolorbox[list inside=\EnvInformationBoxRoundListingExt,list type=\EnvInformationBoxRoundListingExt,auto counter,number within=section]%
{informationbox}%
[1][]%
{
  title={#1},
  detach title,
  coltitle=\EnvInformationBoxRoundTitleColor,
  fonttitle=\EnvInformationBoxRoundTitleFont,
  before={\vspace{\EnvInformationBoxRoundBeforeSpace}},
  after={\vspace{\EnvInformationBoxRoundAfterSpace}},
  breakable,%pad at break=1mm,
  enhanced,
  arc      =\EnvInformationBoxRoundBoxArc,
  colback=\EnvInformationBoxRoundBackColor,
  colframe=\EnvInformationBoxRoundFrameColor,
  leftrule=\EnvInformationBoxRoundLeftRule+\EnvInformationBoxRoundThickness,
  toprule=\EnvInformationBoxRoundThickness, rightrule=\EnvInformationBoxRoundThickness, bottomrule=\EnvInformationBoxRoundThickness,
  drop fuzzy shadow=black,
  %before upper={\textbf{\tcbtitle: }},
  overlay  ={\node[anchor=north west,outer sep=0pt] 
    at (frame.north west) {%
    %\EnvInformationBoxRoundPreTitle\\
    %\thetcbcounter\\
    \begin{minipage}{\EnvInformationBoxRoundLeftRule-2\EnvInformationBoxRoundThickness}
    %\vspace{1mm}
    \centering
    \EnvInformationBoxRoundImage
    \end{minipage}
    };},
  code={
  \ifdefempty{\tcbtitletext}
    {
    \tcbset{list text={ \InformationBoxRoundFirstLetterUppercase{\EnvInformationBoxRoundPreTitle}  }} %% texto en TOC
    }
    {%% \tcbtitle is the title write by the user
    \tcbset{list text={#1}} %% texto en TOC
    }
  %
  \ifdefempty{\tcbtitletext}
    {
    \tcbset{before upper={\addtocounter{informationboxCounter}{-1}\refstepcounter{informationboxCounter} \refstepcounter{informationboxCounter}}}
    }
    {%% \tcbtitle is the title write by the user
    \tcbset{before upper={\addtocounter{informationboxCounter}{-1}\refstepcounter{informationboxCounter} \textcolor{\EnvInformationBoxRoundTitleColor}{\EnvInformationBoxRoundTitleFont\tcbtitle: }\refstepcounter{informationboxCounter}}}
    }
  },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% List of type 
%% Usar con:  \tcblistof[\section*]{\EnvInformationBoxRoundListingExt}{Lista de frases}
%%
\titlecontents{\EnvInformationBoxRoundListingExt}[2.00cm] %% Indentation %% left
{\EnvInformationBoxRoundTocEntryFormat} %% Spacing and font options for sections %% above code
{\contentslabel[{\thecontentslabel}]{1.45cm}} %% Section number %% numbered-entry-format % {\thetcbcounter}%
{} %% numberless-entry-format
{\ \titlerule*[.5pc]{.}\;\color{black}\thecontentspage} %% filler-page-format 
[] %% separator



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\makeatletter
%\newcommand{\ttll@\EnvInformationBoxRoundListingExt}{-1000}
%\makeatother
%% To next warning
%% Package titletoc Warning: Unknown TOC type EnvInformationBoxRoundListingExt. I'll set it for you with(titletoc)                level -1000. on input line 1.
