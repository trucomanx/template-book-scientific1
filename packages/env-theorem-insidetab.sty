%% source:
%% https://github.com/trucomanx/env-theorem-insidetab


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{env-theorem-insidetab}[2022/05/21 Package with macros to the math enviroment]


\RequirePackage[most]{tcolorbox}
\RequirePackage{xcolor}
\RequirePackage[explicit]{titlesec} %% sections
\RequirePackage{titletoc} %% TOC
\RequirePackage{xparse} %%\ExplSyntaxOn
\RequirePackage{pifont} %% \ding{111}
\RequirePackage{varwidth}

% Options
%\DeclareOption{red}{\renewcommand{\wordcolour}{sharelatexcolour}}
\DeclareOption*{\PackageWarning{env-theorem-insidetab}{The option ‘\CurrentOption’ is current unknown}}
\ProcessOptions\relax


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Macros 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% defining variable


\newlength{\EnvTheoremInsideTabPostPic}
\setlength{\EnvTheoremInsideTabPostPic}{1ex}
\newcommand{\SetEnvTheoremInsideTabPostPic}[1]{\setlength{\EnvTheoremInsideTabPostPic}{#1}}%

\newlength{\EnvTheoremInsideTabThickness}
\setlength{\EnvTheoremInsideTabThickness}{1pt}
\newcommand{\SetEnvTheoremInsideTabThickness}[1]{\setlength{\EnvTheoremInsideTabThickness}{#1}}%

\newlength{\EnvTheoremInsideTabLeftPadding}
\setlength{\EnvTheoremInsideTabLeftPadding}{1ex}
\newcommand{\SetEnvTheoremInsideTabLeftPadding}[1]{\setlength{\EnvTheoremInsideTabLeftPadding}{#1}}%

\newlength{\EnvTheoremInsideTabRightPadding}
\setlength{\EnvTheoremInsideTabRightPadding}{1ex}
\newcommand{\SetEnvTheoremInsideTabRightPadding}[1]{\setlength{\EnvTheoremInsideTabRightPadding}{#1}}%

\newlength{\EnvTheoremInsideTabTopPadding}
\setlength{\EnvTheoremInsideTabTopPadding}{1ex}
\newcommand{\SetEnvTheoremInsideTabTopPadding}[1]{\setlength{\EnvTheoremInsideTabTopPadding}{#1}}%

\newlength{\EnvTheoremInsideTabBottomPadding}
\setlength{\EnvTheoremInsideTabBottomPadding}{1ex}
\newcommand{\SetEnvTheoremInsideTabBottomPadding}[1]{\setlength{\EnvTheoremInsideTabBottomPadding}{#1}}%

%% Define before space
\newcommand{\EnvTheoremInsideTabBeforeSpace}{0pt}
\newcommand{\SetEnvTheoremInsideTabBeforeSpace}[1]{\renewcommand{\EnvTheoremInsideTabBeforeSpace}{#1}}%

%% Define after space
\newcommand{\EnvTheoremInsideTabAfterSpace}{0pt}
\newcommand{\SetEnvTheoremInsideTabAfterSpace}[1]{\renewcommand{\EnvTheoremInsideTabAfterSpace}{#1}}%

%% Define showed name of enviroment
\newcommand{\EnvTheoremInsideTabPreTitle}{THEOREM}
\newcommand{\SetEnvTheoremInsideTabPreTitle}[1]{\renewcommand{\EnvTheoremInsideTabPreTitle}{#1}}%

%% Define the frame color of enviroment
\newcommand{\EnvTheoremInsideTabFrameColor}{black}
\newcommand{\SetEnvTheoremInsideTabFrameColor}[1]{\renewcommand{\EnvTheoremInsideTabFrameColor}{#1}}%

%% Define the tab color of enviroment
\newcommand{\EnvTheoremInsideTabRightTabColor}{black}
\newcommand{\SetEnvTheoremInsideTabRightTabColor}[1]{\renewcommand{\EnvTheoremInsideTabRightTabColor}{#1}}%

\newcommand{\EnvTheoremInsideTabLeftTabColor}{green!30!black}
\newcommand{\SetEnvTheoremInsideTabLeftTabColor}[1]{\renewcommand{\EnvTheoremInsideTabLeftTabColor}{#1}}%


%% Define the backaground body text color
\newcommand{\EnvTheoremInsideTabBackColor}{gray!10!white}
\newcommand{\SetEnvTheoremInsideTabBackColor}[1]{\renewcommand{\EnvTheoremInsideTabBackColor}{#1}}%

%% Define The pre title body color 
\newcommand{\EnvTheoremInsideTabPreTitleColor}{green!30!black}
\newcommand{\SetEnvTheoremInsideTabPreTitleColor}[1]{\renewcommand{\EnvTheoremInsideTabPreTitleColor}{#1}}%

%% Define The title body color 
\newcommand{\EnvTheoremInsideTabTitleColor}{gray!10!white}
\newcommand{\SetEnvTheoremInsideTabTitleColor}[1]{\renewcommand{\EnvTheoremInsideTabTitleColor}{#1}}%

%% Define the tile font 
\newcommand{\EnvTheoremInsideTabTitleFont}{\bfseries}
\newcommand{\SetEnvTheoremInsideTabTitleFont}[1]{\renewcommand{\EnvTheoremInsideTabTitleFont}{#1}}%

%% Define the image of pretitle
\newcommand{\EnvTheoremInsideTabImage}{{\color{green!30!black}\ding{113}}}
\newcommand{\SetEnvTheoremInsideTabImage}[1]{\renewcommand{\EnvTheoremInsideTabImage}{#1}}%


%% Warning: These variables dont have \Set... method
\newcommand{\EnvTheoremInsideTabListingExt}{EnvTheoremInsideTabListingExt}
\newcommand{\EnvTheoremInsideTabTocEntryFormat}{}


%
\newcommand{\EnvTheoremInsideTabPicWidth}{4ex}



%% Crea una macro que capitaliza la primera letra
\ExplSyntaxOn
\NewExpandableDocumentCommand \FirstLetterUppercase { O{} m }
  { \text_titlecase:nn {#1} {#2} }
\ExplSyntaxOff

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Create a new counter that will follow tcolorbox's numbering
%% Create a new counter that will follow tcolorbox's numbering
\newcounter{theoremCounter}[section]
\renewcommand*{\thetheoremCounter}{\noexpand\thesection.\noexpand\arabic{theoremCounter}}

\newtcolorbox[list inside=\EnvTheoremInsideTabListingExt,list type=\EnvTheoremInsideTabListingExt,auto counter,number within=section]%
{theorem}%
[1][]%
{
enhanced,
breakable,
%
before={\vspace{\EnvTheoremInsideTabBeforeSpace}},
after={\vspace{\EnvTheoremInsideTabAfterSpace}},
%before skip=2mm,
%after skip=2mm,
colback=\EnvTheoremInsideTabBackColor,
colframe=\EnvTheoremInsideTabFrameColor,
%%boxrule=0.2mm,
leftrule=\EnvTheoremInsideTabThickness,
toprule=\EnvTheoremInsideTabThickness, 
rightrule=\EnvTheoremInsideTabThickness, 
bottomrule=\EnvTheoremInsideTabThickness,
%
left=\EnvTheoremInsideTabLeftPadding,
right=\EnvTheoremInsideTabRightPadding,
top=\EnvTheoremInsideTabTopPadding,
bottom=\EnvTheoremInsideTabBottomPadding,
%
attach boxed title to top left={xshift=1cm,yshift*=1mm-\tcboxedtitleheight},
varwidth boxed title*=-3cm,
boxed title style={frame code={
\path[fill=\EnvTheoremInsideTabRightTabColor]
([yshift=-1mm,xshift=-1mm]frame.north west)
arc[start angle=0,end angle=180,radius=1mm]
([yshift=-1mm,xshift=1mm]frame.north east)
arc[start angle=180,end angle=0,radius=1mm];
\path[left color=\EnvTheoremInsideTabLeftTabColor,right color=\EnvTheoremInsideTabRightTabColor,middle color=\EnvTheoremInsideTabRightTabColor]
([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)
[rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)
-- (frame.south east) -- (frame.south west)
-- ([xshift=-1mm,yshift=-1mm]frame.north west)
[sharp corners]-- cycle;
},interior engine=empty,
},
fonttitle=\EnvTheoremInsideTabTitleFont,
  code={
  \ifdefempty{\tcbtitletext}
    {
    \tcbset{list text={ \FirstLetterUppercase{\EnvTheoremInsideTabPreTitle}  }}
    }
    {%% \tcbtitle is the title write by the user
    \tcbset{list text={#1}}
    }
  %
  \ifdefempty{\tcbtitletext}
    {
        \tcbset{before upper={\addtocounter{theoremCounter}{-1}\refstepcounter{theoremCounter}%
        \EnvTheoremInsideTabImage
        \hspace{\EnvTheoremInsideTabPostPic}%
        \textcolor{\EnvTheoremInsideTabPreTitleColor}{\EnvTheoremInsideTabTitleFont\EnvTheoremInsideTabPreTitle\;\thetcbcounter:} \refstepcounter{theoremCounter}}}
    }
    {%% \tcbtitle is the title write by the user
        \tcbset{before upper={\addtocounter{theoremCounter}{-1}\refstepcounter{theoremCounter}%
        \EnvTheoremInsideTabImage
        \hspace{\EnvTheoremInsideTabPostPic}%
        \textcolor{\EnvTheoremInsideTabPreTitleColor}{\EnvTheoremInsideTabTitleFont\EnvTheoremInsideTabPreTitle\;\thetcbcounter\;- \tcbtitle:} \refstepcounter{theoremCounter}}}
    }
  },
coltitle=\EnvTheoremInsideTabTitleColor,
title={#1}%{  #1} 
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% List of type 
%% Usar con:  \tcblistof[\section*]{\EnvTheoremInsideTabListingExt}{Lista de frases}
%%
\titlecontents{\EnvTheoremInsideTabListingExt}[2.00cm] %% Indentation %% left
{\EnvTheoremInsideTabTocEntryFormat} %% Spacing and font options for sections %% above code
{\contentslabel[{\thecontentslabel}]{1.45cm}} %% Section number %% numbered-entry-format % {\thetcbcounter}%
{} %% numberless-entry-format
{\ \titlerule*[.5pc]{.}\;\color{black}\thecontentspage} %% filler-page-format 
[] %% separator



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\makeatletter
%\newcommand{\ttll@\EnvTheoremInsideTabListingExt}{-1000}
%\makeatother
%% To next warning
%% Package titletoc Warning: Unknown TOC type EnvTheoremInsideTabListingExt. I'll set it for you with(titletoc)                level -1000. on input line 1.
