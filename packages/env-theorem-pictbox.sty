%% source:
%% https://github.com/trucomanx/env-theorem-pictbox


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{env-theorem-pictbox}[2022/05/21 Package with macros to the math enviroment]


\RequirePackage[most]{tcolorbox}
\RequirePackage{xcolor}
\RequirePackage[explicit]{titlesec} %% sections
\RequirePackage{titletoc} %% TOC
\RequirePackage{xparse} %%\ExplSyntaxOn


% Options
%\DeclareOption{red}{\renewcommand{\wordcolour}{sharelatexcolour}}
\DeclareOption*{\PackageWarning{env-theorem-pictbox}{The option ‘\CurrentOption’ is current unknown}}
\ProcessOptions\relax


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Macros 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% defining variable
\newlength{\EnvTheoremPictBoxLength}
\setlength{\EnvTheoremPictBoxLength}{1pt}
%
\newcommand{\EnvTheoremPictBoxThickness}{1.5pt}

%% Define before space
\newcommand{\EnvTheoremPictBoxBeforeSpace}{\EnvTheoremPictBoxLength}
\newcommand{\SetEnvTheoremPictBoxBeforeSpace}[1]{\renewcommand{\EnvTheoremPictBoxBeforeSpace}{#1}}%

%% Define after space
\newcommand{\EnvTheoremPictBoxAfterSpace}{0pt}
\newcommand{\SetEnvTheoremPictBoxAfterSpace}[1]{\renewcommand{\EnvTheoremPictBoxAfterSpace}{#1}}%

%% Define showed name of enviroment
\newcommand{\EnvTheoremPictBoxPreTitle}{THEOREM}
\newcommand{\SetEnvTheoremPictBoxPreTitle}[1]{\renewcommand{\EnvTheoremPictBoxPreTitle}{#1}}%

%% Define the frame color of enviroment
\newcommand{\EnvTheoremPictBoxFrameColor}{red!50!black}
\newcommand{\SetEnvTheoremPictBoxFrameColor}[1]{\renewcommand{\EnvTheoremPictBoxFrameColor}{#1}}%

%% Define the backaground body text color
\newcommand{\EnvTheoremPictBoxBackColor}{gray!10}
\newcommand{\SetEnvTheoremPictBoxBackColor}[1]{\renewcommand{\EnvTheoremPictBoxBackColor}{#1}}%

%% Define The title body color 
\newcommand{\EnvTheoremPictBoxTitleColor}{blue}
\newcommand{\SetEnvTheoremPictBoxTitleColor}[1]{\renewcommand{\EnvTheoremPictBoxTitleColor}{#1}}%

%% Define the tile font 
\newcommand{\EnvTheoremPictBoxTitleFont}{\bfseries\sffamily}
\newcommand{\SetEnvTheoremPictBoxTitleFont}[1]{\renewcommand{\EnvTheoremPictBoxTitleFont}{#1}}%

%% Define the image of pretitle
\newcommand{\EnvTheoremPictBoxImage}{}
\newcommand{\SetEnvTheoremPictBoxImage}[1]{\renewcommand{\EnvTheoremPictBoxImage}{#1}}%


%% Warning: These variables dont have \Set... method
\newcommand{\EnvTheoremPictBoxListingExt}{EnvTheoremPictBoxListingExt}
\newcommand{\EnvTheoremPictBoxTocEntryFormat}{}
%
\newcommand{\EnvTheoremPictBoxBoxArc}{}
\newcommand{\EnvTheoremPictBoxLeftRule}{24mm}
\newcommand{\EnvTheoremPictBoxLeftHalfRule}{12mm}


%% Crea una macro que capitaliza la primera letra
\ExplSyntaxOn
\NewExpandableDocumentCommand \FirstLetterUppercase { O{} m }
  { \text_titlecase:nn {#1} {#2} }
\ExplSyntaxOff

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Create a new counter that will follow tcolorbox's numbering
%% Create a new counter that will follow tcolorbox's numbering
\newcounter{theoremCounter}[section]
\renewcommand*{\thetheoremCounter}{\noexpand\thesection.\noexpand\arabic{theoremCounter}}

\newtcolorbox[list inside=\EnvTheoremPictBoxListingExt,list type=\EnvTheoremPictBoxListingExt,auto counter,number within=section]%
{theorem}%
[1][]%
{
  enhanced jigsaw,
  colback=\EnvTheoremPictBoxBackColor,
  colframe=\EnvTheoremPictBoxFrameColor,
  coltitle=\EnvTheoremPictBoxTitleColor,
  fonttitle=\EnvTheoremPictBoxTitleFont,
  detach title,
  leftrule=\EnvTheoremPictBoxLeftRule,
  toprule=\EnvTheoremPictBoxThickness, rightrule=\EnvTheoremPictBoxThickness, bottomrule=\EnvTheoremPictBoxThickness,
  underlay unbroken and first={\node[below,text=white,font=\EnvTheoremPictBoxTitleFont,align=center]
    at ([xshift=-\EnvTheoremPictBoxLeftHalfRule,yshift=-1mm]interior.north west) {%
    \EnvTheoremPictBoxPreTitle\\
    \thetcbcounter\\
    \begin{minipage}{\EnvTheoremPictBoxLeftRule}
    \vspace{1mm}
    \centering
    \EnvTheoremPictBoxImage
    \end{minipage}
    };},
  breakable,pad at break=1mm,
  title={#1},
  before={\vspace{\EnvTheoremPictBoxBeforeSpace}},
  after={\vspace{\EnvTheoremPictBoxAfterSpace}},
  code={
  \ifdefempty{\EnvTheoremPictBoxBoxArc}
    { \tcbset{sharp corners} }{\tcbset{arc=\EnvTheoremPictBoxBoxArc} }
  %
  \ifdefempty{\tcbtitletext}
    {
    \tcbset{list text={ \FirstLetterUppercase{\EnvTheoremPictBoxPreTitle}  }}
    }
    {%% \tcbtitle is the title write by the user
    \tcbset{list text={#1}}
    }
  %
  \ifdefempty{\tcbtitletext}
    {
    \tcbset{before upper={\addtocounter{theoremCounter}{-1}\refstepcounter{theoremCounter} \refstepcounter{theoremCounter}}}
    }
    {%% \tcbtitle is the title write by the user
    \tcbset{before upper={\addtocounter{theoremCounter}{-1}\refstepcounter{theoremCounter} \tcbtitle\par\medskip\refstepcounter{theoremCounter}}}
    }
  },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% List of type 
%% Usar con:  \tcblistof[\section*]{\EnvTheoremPictBoxListingExt}{Lista de frases}
%%
\titlecontents{\EnvTheoremPictBoxListingExt}[2.00cm] %% Indentation %% left
{\EnvTheoremPictBoxTocEntryFormat} %% Spacing and font options for sections %% above code
{\contentslabel[{\thecontentslabel}]{1.45cm}} %% Section number %% numbered-entry-format % {\thetcbcounter}%
{} %% numberless-entry-format
{\ \titlerule*[.5pc]{.}\;\color{black}\thecontentspage} %% filler-page-format 
[] %% separator



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\makeatletter
%\newcommand{\ttll@\EnvTheoremPictBoxListingExt}{-1000}
%\makeatother
%% To next warning
%% Package titletoc Warning: Unknown TOC type EnvTheoremPictBoxListingExt. I'll set it for you with(titletoc)                level -1000. on input line 1.
